{% extends 'layout.html.twig' %}
{% import _self as self %}

{% macro pollution_data(dataList, pollutant) %}
    {% if dataList[pollutant] is defined %}
    {% set data = dataList[pollutant]|first %}
    <td class="pollution-value pollutant-{{ data.pollutant.identifier }}" data-value="{{ data.data.value }}" style="background-color: {{ pollution_color(data.pollutionLevel) }}">
        {{ data.data.value }} {{ data.pollutant.unitHtml|raw }}
    </td>
    {% else %}
    <td></td>
    {% endif %}
{% endmacro %}

{% block content %}
    <div class="container">
        <div class="row">
            <div class="col-12 text-center">
                <h2 class="h3">
                    Historische Messwerte der Station {{ station.stationCode }}
                </h2>

                <p class="lead">
                    An der Station {{ station.stationCode }}{% if station.city %} in <a href="{{ path('show_city', { citySlug: station.city.slug }) }}" title="Zeige weitere Schadstoff-Messwerte aus {{ station.city.name }} an">{{ station.city.name }}</a>{% endif %} wurden vom {{ fromDateTime|date('d.m.Y') }} bis zum {{ untilDateTime|date('d.m.Y') }} die folgenden Werte gemessen:
                </p>
            </div>
        </div>

        <div class="row">
            <div class="col-12">
                <canvas id="pollutionChart" width="400" height="400"></canvas>
            </div>
        </div>

        <div class="row">
            <div class="col-12">
                <table class="table">
                    <thead>
                        <tr>
                            <th>
                                Zeitpunkt
                            </th>

                            <th class="pollutant" data-pollutant-identifier="pm10">
                                PM<sub>10</sub>
                            </th>

                            <th class="pollutant" data-pollutant-identifier="pm25">
                                PM<sub>25</sub>
                            </th>

                            <th class="pollutant" data-pollutant-identifier="o3">
                                O<sub>3</sub>
                            </th>

                            <th class="pollutant" data-pollutant-identifier="no2">
                                NO<sub>2</sub>
                            </th>

                            <th class="pollutant" data-pollutant-identifier="so2">
                                SO<sub>2</sub>
                            </th>

                            <th class="pollutant" data-pollutant-identifier="co">
                                CO
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                    {% for timestamp, dataList in dataLists %}
                        {% if dataList|length > 0 %}
                        <tr class="datetime" data-timestamp="{{ timestamp }}">
                            <td>
                                {{ timestamp|date('d.m.Y H:i') }} Uhr
                            </td>

                            {{ self.pollution_data(dataList, 1) }}
                            {{ self.pollution_data(dataList, 6) }}
                            {{ self.pollution_data(dataList, 2) }}
                            {{ self.pollution_data(dataList, 3) }}
                            {{ self.pollution_data(dataList, 4) }}
                            {{ self.pollution_data(dataList, 5) }}
                        </tr>
                        {% endif %}
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
{% endblock %}

{% block scripts %}
    <script src="{{ asset('/js/leaflet.extra-markers.min.js') }}"></script>
    <script src="{{ asset('/js/map.min.js') }}"></script>
    <script src="{{ asset('/js/Chart.bundle.min.js') }}"></script>
    <script src="{{ asset('/js/history.min.js') }}"></script>
{% endblock %}
